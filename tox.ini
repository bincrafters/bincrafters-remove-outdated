[tox]
skipsdist=True
envlist =
    py{27,35,37,38}-conan-{dev,latest}

[testenv]
deps =
    conan-dev: https://github.com/conan-io/conan/archive/develop.tar.gz
    conan-latest: conan
    coverage: coverage-enable-subprocess
    -r {toxinidir}/bincrafters_remove_outdated/requirements.txt
    -r {toxinidir}/bincrafters_remove_outdated/requirements_test.txt

setenv =
    PYTHONDONTWRITEBYTECODE=1
    PYTHONPATH = {toxinidir}{:}{env:PYTHONPATH:}
    USE_UNSUPPORTED_CONAN_WITH_PYTHON_2=1

    coverage: PYTEST_TEST_RUNNER=coverage run -m pytest
    coverage: COVERAGE_PROCESS_START={toxinidir}/.coveragerc
    coverage: COVERAGE_FILE={toxinidir}/.coverage
    coverage: PYTESTDJANGO_COVERAGE_SRC={toxinidir}/

passenv = PYTEST_ADDOPTS USE_UNSUPPORTED_CONAN_WITH_PYTHON_2

commands =
    coverage: coverage erase
    {env:PYTEST_TEST_RUNNER:pytest} {posargs:tests}
    coverage: coverage combine
    coverage: coverage report
    coverage: coverage xml
